<!DOCTYPE html>
<html lang="en-US">


<head>

    <link rel="stylesheet" href="teacher_styles.css">


    <!-- script to grab the textbox input from teacher_newclass.html and display it as title to this page -->
    <!-- TODO: This script is not working 100%, not grabbing courseTitle from createClass page after selectedCourse has happened -->
    <script>
        
      window.onload = function () {
        const selectedCourseTitle = localStorage.getItem('selectedCourseTitle');
        const defaultTitle = "Default Course Title";

        // if courseTitle exists in local storage, grab it and display it
        if (selectedCourseTitle) {
            document.getElementById('courseTitle').textContent = selectedCourseTitle;
        } else {
            document.getElementById('courseTitle').textContent = defaultTitle;
        }
    }



        // function to allow user to import a file when Import Test is clicked
        function importTest() {
            document.getElementById('fileInput').click();
        }

        // function to handle the file upload process for user
        function handleFileUpload(event) {
            const file = event.target.files[0];
            if (file) {
                // Handle the file upload process here
                console.log('File selected:', file.name);
                // Code that connects file to the databse will go here
            }
        }


        // function to handle the form submit event for the new question popup
        function handleQuestionSave(event) {
            event.preventDefault(); // Prevent the default form submission, requires all data fields be entered

            // Get the values from the textboxes
            const chapter = document.getElementById('ch').value;
            const section = document.getElementById('sec').value;
            const question = document.getElementById('question').value;
            const reference = document.getElementById('ref').value;
            const answer = document.getElementById('ans').value;
            const answerChoices = document.getElementById('ans_c').value;
            const points = document.getElementById('points').value;
            const time = document.getElementById('time').value;
            const instructions = document.getElementById('ins').value;
            const image = document.getElementById('image').dataset.base64 || '';

            // Create an object to store the question data
            const questionData = {
                chapter,
                section,
                question,
                reference,
                answer,
                answerChoices,
                points,
                time,
                instructions,
                image
            };

            // Save the question data to local storage
            localStorage.setItem('questionData', JSON.stringify(questionData));

            // Close the form
            closeForm();
        }


        // function to display the selected question type -> should this go on view TB? or both?
        function displayQuestionType(type) {
            document.getElementById('selectedQuestionType').textContent = `Selected Question Type: ${type}`;
        }

        // Function to handle the image upload process
        function handleImageUpload(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function (e) {
                    const base64String = e.target.result;
                    document.getElementById('image').dataset.base64 = base64String;
                    document.getElementById('imagePreview').src = base64String;
                    document.getElementById('imagePreview').style.display = 'block';
                };
                reader.readAsDataURL(file);
            }
        }

    </script>




</head>


<body>
    <!-- This is the page where the teacher can see all of their questions-->
    <div class="center large-heading sticky">
        <h1 id="courseTitle">Course Title</h1>
    </div>
    <div class="center large-paragraph">


        <!--Button to go to view test bank page-->
        <a href="Teacher_viewTB.html">
            <button class="button">View Test Banks</button>
        </a>

        <a href="Teacher_newTB.html">
            <button class="button">New Test Bank</button>
        </a>
        <a href="#">
            <button class="button" onclick="importTest()">Import Test</button>
        </a><br>


        <div class="dropdown">
            <button class="dropbtn">Question Type</button>
            <div class="dropdown-content">
                <a href="#" onclick="displayQuestionType('True/False')">True/False</a>
                <a href="#" onclick="displayQuestionType('Multiple Choice')">Multiple Choice</a>
                <a href="#" onclick="displayQuestionType('Matching')">Matching</a>
                <a href="#" onclick="displayQuestionType('Fill in the Blank')">Fill in the Blank</a>
                <a href="#" onclick="displayQuestionType('Short Answer')">Short Answer</a>
                <a href="#" onclick="displayQuestionType('Essay')">Essay</a>
            </div>
        </div>
        <button class="button" onclick="edit()">New Question</button>

        <a href="Teacher_pubTB.html">
            <button class="button">Publisher Textbook Page</button>
        </a>

        <!-- this was for testing and can be deleted when done -->
        <div id="selectedQuestionType" class="center large-paragraph"></div>

    </div>

    <!--file input element -->
    <input type="file" id="fileInput" style="display: none;" onchange="handleFileUpload(event)">


    <!-- contents of popup-->
    <div class="form-popup" id="q_edit">
        <form class="form-container" onsubmit="handleQuestionSave(event)">
            <h1>New Question</h1>

            <label for="ch"><b>Chapter Number</b></label><br>
            <input type="text" id="ch" name="ch" required><br>

            <label for="sec"><b>Section Number</b></label><br>
            <input type="text" id="sec" name="sec" required><br>

            <label for="question"><b>Question</b></label><br>
            <input type="text" id="question" name="question" required><br>

            <label for="ref"><b>Text Reference</b></label><br>
            <input type="text" id="ref" name="ref" required><br>

            <label for="ans"><b>Answer</b></label><br>
            <input type="text" id="ans" name="ans" required><br>

            <label for="ans_c"><b>Answer Choices</b></label><br>
            <input type="text" id="ans_c" name="ans_c"><br>

            <label for="points"><b>Points Worth</b></label><br>
            <input type="text" id="points" name="points" required><br>

            <label for="time"><b>Est Time</b></label><br>
            <input type="text" id="time" name="time" required><br>

            <label for="ins"><b>Grading Instructions</b></label><br>
            <input type="text" id="ins" name="ins" required><br>

            <label for="image"><b>Upload Image</b></label><br>
            <input type="file" id="image" name="image" accept="image/*" onchange="handleImageUpload(event)"><br>
            <img id="imagePreview" src="#" alt="Image preview"
                style="display: none; max-width: 100%; max-height: 100%;"><br>

            <!-- still need to add "in test already" view somewhere -->

            <button type="submit" class="btn">Save</button>
            <button type="button" class="btn cancel" onclick="closeForm()">Close</button>
        </form>
    </div>

    <!--JavaScript that allows popup to function-->
    <script>
        function edit() {
            document.getElementById("q_edit").style.display = "block";
        }

        function closeForm() {
            document.getElementById("q_edit").style.display = "none";
        }
    </script>
</body>